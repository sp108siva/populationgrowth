<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>CS 416 Data Visualization - Final Project </title>
  <meta name="author" content="Your Name">
  <meta name="description" content="">
  <link rel="stylesheet" href="css/annotation-style.css">
</head>
<style>
body {
  font: 16px sans-serif;
  background-image: url('/data/image.jpg');
}
.headerstyle {
  display: flex;
  padding-left: 20px;
  margin: 1rem;
  flex-wrap: wrap;
  justify-content: center;
  font-family: Georgia,serif;
}
#dataviz {
  text-align: center;
}
.tooltip {
  position: absolute;
  font-size: 13px;
  width: auto;
  height: auto;
  pointer-events: none;
  background: #e3f2fd;
  border: 1px solid #1976d2;
  color: #222;
  border-radius: 6px;
  padding: 6px 10px;
}
.axis--x path {
  display: none;
}
.axis--y path {
  display: none;
}
.bar-gdp {
  fill: #1976d2;
}
.bar-pop {
  fill: #43a047;
}
.annotation {
  font-size: 15px;
  fill: #d32f2f;
  font-weight: bold;
}
/*pagination and other styles...*/
.pag_sec a {
    color: black;
    float: left;
    padding: 8px 16px;
    text-decoration: none;
    transition: background-color .3s;
    border: 1px solid #ddd;
    margin: 0 4px;
}

.pag_sec a.active {
    background-color: #3c6fa0;
    color: white;

}
.cen {
    text-align: right;
    margin-top: 2rem;
}
.pag_sec a.highlight {
    background-color: #00b9c2;
    color: white;
    border: 1px solid #af4c4c;
}
.pag_sec {
    display: inline-block;
}
.pag_sec a {
    border-radius: 5px;
}

.pag_sec a.active {
    border-radius: 5px;
}

ul li {
  margin-top: 15px;
  word-wrap: break-word;
  line-height: 25px;
}
</style>
<body>
<div class="headerstyle">
  <h1>GDP Growth vs Population Growth by Country</h1>
</div>
<hr style="width:40%;text-align:center;margin-left:auto;">
<ul>
  <li>Grouped bar chart comparing GDP growth and population growth for each country. X-axis: countries, Y-axis: percentage growth.</li>
  <li>This chart allows direct comparison of economic and demographic growth for each country.</li>
  <li>Dataset covers years 2000 to 2018.</li>
</ul>
<div class="cen">
  <div class="pag_sec">
      <a href="#"class="highlight">1</a>
      <a href="carbonemission.html">2</a>
      <a href="forest.html" >3</a>
      <a href="carbonemission.html" class="active">&nbsp &nbspNext Page &nbsp &nbsp</a>
  </div>
</div>
<div id="dataviz">
  <svg width="1100" height="550"></svg>
</div>
<script src="https://unpkg.com/d3@4.13.0/build/d3.min.js"></script>
<script>
var margin = {top: 40, right: 20, bottom: 120, left: 60},
    width = 1000 - margin.left - margin.right,
    height = 450 - margin.top - margin.bottom;

var svg = d3.select("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

d3.csv("https://raw.githubusercontent.com/sp108siva/populationgrowth/main/data/pop_gdp.csv", function(data) {
  // Filter for countries with high population growth AND high GDP growth
  // Let's define high as top 15 by population growth, then sort those by GDP growth and take the top 10
  data = data.filter(function(d) { return +d.population_growth > 30; });
  data = data.sort(function(a, b) { return +b.gdp_growth_rate - +a.gdp_growth_rate; }).slice(0, 10);
  var subgroups = ["gdp_growth_rate", "population_growth"];
  var groups = data.map(function(d) { return d.country; });

  var x0 = d3.scaleBand().domain(groups).range([0, width]).padding(0.2);
  var x1 = d3.scaleBand().domain(subgroups).range([0, x0.bandwidth()]).padding(0.05);
  var y = d3.scaleLinear().domain([0, d3.max(data, function(d) { return Math.max(+d.gdp_growth_rate, +d.population_growth); }) * 1.1]).range([height, 0]);

  svg.append("g")
    .attr("class", "axis axis--x")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x0))
    .selectAll("text")
      .attr("transform", "rotate(-40)")
      .style("text-anchor", "end");

  svg.append("g")
    .attr("class", "axis axis--y")
    .call(d3.axisLeft(y));

  var color = d3.scaleOrdinal()
    .domain(subgroups)
    .range(["#1976d2", "#43a047"]);

  svg.append("g")
    .selectAll("g")
    .data(data)
    .enter().append("g")
      .attr("transform", function(d) { return "translate(" + x0(d.country) + ",0)"; })
    .selectAll("rect")
    .data(function(d) { return subgroups.map(function(key) { return {key: key, value: +d[key], country: d.country}; }); })
    .enter().append("rect")
      .attr("x", function(d) { return x1(d.key); })
      .attr("y", function(d) { return y(d.value); })
      .attr("width", x1.bandwidth())
      .attr("height", function(d) { return height - y(d.value); })
      .attr("class", function(d) { return d.key === "gdp_growth_rate" ? "bar-gdp" : "bar-pop"; })
      .on("mouseover", function(event, d) {
        tooltip.transition().duration(200).style("opacity", 1);
        tooltip.html("<b>Country:</b> " + d.country + "<br/><b>" + (d.key === "gdp_growth_rate" ? "GDP Growth Rate" : "Population Growth") + ":</b> " + d.value + "%")
          .style("left", (event.pageX + 15) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition().duration(300).style("opacity", 0);
      });

  // Add legend
  var legend = svg.append("g")
    .attr("transform", "translate(" + (width - 200) + ",0)");
  legend.append("rect").attr("x", 0).attr("y", 0).attr("width", 18).attr("height", 18).attr("fill", "#1976d2");
  legend.append("text").attr("x", 26).attr("y", 13).text("GDP Growth Rate");
  legend.append("rect").attr("x", 0).attr("y", 28).attr("width", 18).attr("height", 18).attr("fill", "#43a047");
  legend.append("text").attr("x", 26).attr("y", 41).text("Population Growth");

  // Annotation: highlight the country with the highest GDP growth
  var highlight = data[0];
  if (highlight) {
    svg.append("text")
      .attr("class", "annotation")
      .attr("x", x0(highlight.country) + x1("gdp_growth_rate") + x1.bandwidth()/2)
      .attr("y", y(highlight.gdp_growth_rate) - 15)
      .attr("text-anchor", "middle")
      .text("Highest GDP growth");
  }
});
</script>
</body>
